---
title: "Start synchronizing FCS files with an xlsx file in a new experiment folder"
date: "2021/10/02"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Start synchronizing FCS files with an xlsx file in a new experiment folder}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Install necessary packages in RStudio:
```{r setup, eval=F}
install.packages("BiocManager")
BiocManager::install("flowCore")
BiocManager::install("flowWorkspace")
BiocManager::install("CytoML")
install.packages("devtools")
devtools::install_github("Close-your-eyes/fcexpr")
library(fcexpr)
```

Create a folder for your flow cytometry experiment. Mac-user: To copy the path of a directory use CMD+Alt+C in the Finder.

```{r new_exp, eval=F}
fcexpr::new_exp(path = "/Users/vonskopnik/Documents/experiments", name = "GFP_transduction_establishment")
```
A respective folder should appear in "path". It is prefixed with todays date as date_prefix = TRUE by default in fcexpr::new_exp (see ?fcexpr::new_exp). Also, it has a default structure with a few template folders and files.
```{r new_exp_img, echo=F, out.width = 600}
knitr::include_graphics(base::system.file("extdata", "new_exp.png", package = "fcexpr"))
```

Next we copy FCS files of our first experimental attempt of transducing GFP into a cell line.
```{r files_added_img, echo=F, out.width = 600}
knitr::include_graphics(base::system.file("extdata", "files_added.png", package = "fcexpr"))
```

Then we run fcexpr::sync_sampledescription() from an R-script saved in the R_scripts-folder. This will document FCS files and in an xlsx-file.
```{r sync1, eval=F}
wd <- dirname(dirname(rstudioapi::getActiveDocumentContext()$path))
setwd(wd)
# since we have defined wd as working directory by setwd() and FCS files are
# stored in the FCS_files-folder (the default) we can call
# sync_sampledescription() without defining any function arguments 
fcexpr::sync_sampledescription()
```

This initiates an xlsx-file at the root of our experiment folder.
```{r sync1_img, echo=F, out.width = 600}
knitr::include_graphics(base::system.file("extdata", "sync1.png", package = "fcexpr"))
```

What happens:
(i) All FCS files in the FCS_files folder have been listed in this file.
(ii) The names of FCS files have been prefixed (renamed) by a continuous number.
```{r sd1, echo=F, out.width = 600}
knitr::kable(head(openxlsx::read.xlsx(base::system.file("extdata", "sampledescription1.xlsx", package = "fcexpr"))))
print(paste0("nrow = ", nrow(openxlsx::read.xlsx(base::system.file("extdata", "sampledescription1.xlsx", package = "fcexpr")))))
```

The xlsx-file is intended as mirror of the actual FCS files. Both sides (actual files and xlsx-file) are synced when the sync_sampledescription function is called.
When more FCS files are added and sync_sampledescription is called, the xlsx-file will be extended. Appending of new FCS files to the xlsx-file happens in chronological order of acquisition of FCS files.
```{r files_added2_img, echo=F, out.width = 600}
knitr::include_graphics(base::system.file("extdata", "files_added2.png", package = "fcexpr"))
```

```{r sync2, eval=F}
fcexpr::sync_sampledescription()
```
```{r sd2, echo=F, out.width = 600}
knitr::kable(tail(openxlsx::read.xlsx(base::system.file("extdata", "sampledescription2.xlsx", package = "fcexpr"))))
print(paste0("nrow = ", nrow(openxlsx::read.xlsx(base::system.file("extdata", "sampledescription2.xlsx", package = "fcexpr")))))
```

When the file names in the FileName column of the xlsx-file are altered and sync_sampledescritpion is called subsequently the actual FCS files will be renamed accordingly (~synchronization takes place). Renaming our FCS files like this is much more comfortable than in file browser.
```{r sd3, echo=F, out.width = 600}
knitr::kable(head(openxlsx::read.xlsx(base::system.file("extdata", "sampledescription3.xlsx", package = "fcexpr"))))
```


This makes is easier for yourself and for colleagues to identify what is contained in our FCS files.



